name: Update Domains from Sources

on:
  schedule:
    # Run daily at 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  update-domains:
    if: github.repository == 'disposable-email-domains/disposable-email-domains'
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.11]
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
      - name: Fetch domains from sources
        run: |
          python fetch_domains.py
      - name: Run maintain script
        run: |
          bash maintain.sh
      - name: Verify blocklist
        run: |
          python verify.py
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v7
        with:
          branch: update-domains-from-sources
          committer: dispoBot <martenson@dispobot>
          commit-message: Add missing domains from sources
          title: Update domains from sources
          body: Automatically fetched and added missing domains from configured sources
          labels: automated
          assignees: martenson
          reviewers: martenson

